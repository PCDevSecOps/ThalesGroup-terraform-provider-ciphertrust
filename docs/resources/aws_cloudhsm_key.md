---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_aws_cloudhsm_key Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-
  
---

# ciphertrust_aws_cloudhsm_key (Resource)

When KMS key is created in AWS CloudHSM key store, AWS KMS generates a 256-bit, persistent, 
non-exportable Advanced Encryption Standard (AES) symmetric key in the associated AWS CloudHSM cluster.  

Primary uses of the ciphertrust_aws_cloudhsm_key resource include:
- Creating an AWS key in custom key store of type AWS_CLOUDHSM
- Updating attributes of an linked AWS HYOK key (description, tags, alias, policy, enable/disable)

## Prerequisites
- CloudHSM cluster setup on AWS is required before creating custom key store of type AWS_CLOUDHSM (refer AWS CloudHSM documentation including the AWS Key Management Service Developer Guide and AWS CloudHSM User Guide.)
- For CloudHSM key, CloudHSM Key Store needs to be in `Connected` state before creating CloudHSM key. It takes upto 30 minutes for Connect/Disconnect operations.
- Creation of CloudHSM key is supported in custom key store of type AWS_CLOUDHSM.

## Destroying AWS CloudHSM key

- CloudHSM key store can be deleted only after deleting keys in it.
- For CloudHSM key in AWS, key can be scheduled to be deleted between 7-30 days.

## Example Usage

```terraform
# Pre-requisites for EXTERNAL_KEY_STORE and AWS_CLOUDHSM Key store - AWS connection, AWS KMS
# Create an AWS connection
resource "ciphertrust_aws_connection" "aws-connection" {
  name = "aws_connection_name"
  access_key_id     = "access-key-id"
  secret_access_key = "secret-access-key"
}
output "aws_connection_id" {
  value = ciphertrust_aws_connection.aws-connection.id
}

# Get the AWS account details
data "ciphertrust_aws_account_details" "account_details" {
  aws_connection = ciphertrust_aws_connection.aws-connection.id
}

# Create a kms
resource "ciphertrust_aws_kms" "kms" {
  depends_on = [
    ciphertrust_aws_connection.aws-connection,
  ]
  account_id     = data.ciphertrust_aws_account_details.account_details.account_id
  aws_connection = ciphertrust_aws_connection.aws-connection.id
  name           = "kms-name"
  regions        = data.ciphertrust_aws_account_details.account_details.regions
}

## Create cloudHSM keystore
resource "ciphertrust_aws_custom_keystore" "cloudhsm_custom_keystore" {
  depends_on = [
    ciphertrust_aws_kms.kms,
  ]
  name         = "cloudhsm-keystore-demo-1"
  region       = "us-west-1"
  kms          = ciphertrust_aws_kms.kms.name
  connect_disconnect_keystore = "DISCONNECT_KEYSTORE"
  aws_param {
    custom_key_store_type       = "AWS_CLOUDHSM"
    cloud_hsm_cluster_id        = "cluster-pxkcyeoqij"
    key_store_password          = "keystore-password"
    trust_anchor_certificate    = <<-EOT
	                 -----BEGIN CERTIFICATE-----
	                 MIIDhzCCAm+gAwIBAgIUHdJu4algAFs22h87meBhd9Qe4eMoDQYJKoZIhvcNAQEL
	                 BQAwUzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRAwDgYQVQQHDAdTYW5Kb3Nl
	                 MQ8wDQYDVQQKDAZUaGFsZXMxFDASBgNVBAsMC0VuZ2luZWVyaW5nMB4XDTIyMDYy
	                 MzA2NTgwOFoXDTMyMDYyMjA2NTgwOFowUzELMAkGA1UEBhMCVVMxCzAJBgNVBAgM
	                 AkNBMRAwDgYDVQQHDAdTYW5Kb3NlMQ8wDQYDVQQKDAZUaEFsZXMxFDASBgNVBAsM
	                 C0VtZ2lvZWVyaW5nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvi0o
	                 wtYFziFkbhtH0X0+0fhvcGLJ4SYTOU50ZGa7GlfsKC4i5vGxXFEJ1QwJ+WmkyXwo
	                 RCWaXQbFkFIxlDDIgOe64Z8FRiqdRGXPAYXvJC5pM015kOGtuMrT759Ifbux81Ng
	                 ULlUbz7uLGxut+IbLXIG+/lkDI8OtYNLtU5hbTG/QrTieFg7ZQ/IKKbmCKB3m3cv
	                 l0MzSMZQXMgNmsbb9SASTgSgaBdAF99sp3B78jHFDqikZHvrxjPBRqi/OsSBefmV
	                 LymMhPBVcF9FWJgL+YpxDjKP4ieo8rqWK9xEDnu6VmVx0guQ40uM4ycaDljBueW6
	                 J9FqXFp63FGrGKu2vwIDBQABo1MwUTAdBgMVHQ4EFgQUi/RAIOrEPaUm9T6P+Ju3
	                 qTKpf90wHwYDVR0jBBgwFoAUi/RAIOrEPaUm9T6P+Ju3qTKpf90wDwYDVR0TAQH/
	                 BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAfhC8EghStmPq770Edt6lfoEC6pIO
	                 UCMoiwnX9KL7WdKPx7auyJmxj3+MbYqMSzilXPA57J1WE6BhT3JOT4nPsO/IpFv2
	                 fbpUVW9ypwrRQE1S1v6BjvQd5J49c3ZDfH634jCwGwxcBY2gSbZorLb03aH7R2uF
	                 31jlyotNaUd3eWjo11jwVt9ZhpcxbaiK98Q6UcUro0Ok2BaQdZZthnuMMnwK8iO2
	                 w3XiEJU3uaUbs1jC6x2Q/RQ28cdAl1tse9/isLeH9yqIEuzFWBHEX5OmpcrW7qcv
	                 SWLFSofuUkHD1GuN8f4ipAzQ0Fn9Y2C463Q3DCzolhRmJrfXVgM6XLRnHg==
	                 -----END CERTIFICATE-----
	               EOT
  }
}

data "ciphertrust_aws_custom_keystore" "cloudhsm_custom_keystore_data_source" {
  depends_on = [
    ciphertrust_aws_custom_keystore.cloudhsm_custom_keystore,
  ]
  id = ciphertrust_aws_custom_keystore.cloudhsm_custom_keystore.id
}

# Create a policy template using key users and roles
resource "ciphertrust_aws_policy_template" "template_with_users_and_roles" {
  name             = "template-with-users-and-roles-test"
  kms              = ciphertrust_aws_kms.kms.id
  key_admins       = ["dummyadmin"]
  key_admins_roles = ["dummyadminrole"]
  key_users        = ["dummyuser"]
  key_users_roles  = ["dummyuserrole"]
}
output "template_with_users_and_roles" {
  value = ciphertrust_aws_policy_template.template_with_users_and_roles
}

# Create an cloudhsm key in cloudhsm keystore
resource "ciphertrust_aws_cloudhsm_key" "cloudhsm_key_1" {
  depends_on = [
    ciphertrust_aws_custom_keystore.cloudhsm_custom_keystore,
    ciphertrust_aws_policy_template.template_with_users_and_roles,
  ]

  custom_key_store_id = ciphertrust_aws_custom_keystore.cloudhsm_custom_keystore.id
  description = "desc for cloudhsm_key_1"
  enable_key = false
  alias = ["a5_cloudhsm_key_1"]
  tags = {
    Tagkey34 = "TagValue34"
    Tagkey44 = "TagValue44"
  }
  schedule_for_deletion_days = 7
  key_policy {
    policy_template = ciphertrust_aws_policy_template.template_with_users_and_roles.id
  }
}

output "cloudhsm_key_1" {
  value = ciphertrust_aws_cloudhsm_key.cloudhsm_key_1
}

data "ciphertrust_aws_cloudhsm_key" "cloudhsm_key_1_data" {
  depends_on = [
    ciphertrust_aws_cloudhsm_key.cloudhsm_key_1,
  ]
  arn = "arn:aws:kms:us-west-1:556782317223:key/991fc126-1281-4300-a174-5b39d4e78cb0"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `custom_key_store_id` (String) CloudHSM keystore ID in AWS.

### Optional

- `alias` (Set of String) Input parameter. Alias assigned to the the CloudHSM key
- `auto_rotate` (Boolean) (Updateable) Enable AWS autorotation on the key. Default is false.
- `customer_master_key_spec` (String) Specifies a symmetric or asymmetric key and the encryption\signing algorithms the key supports. Valid values: SYMMETRIC_DEFAULT, RSA_2048, RSA_3072, RSA_4096, ECC_NIST_P256, ECC_NIST_P384, ECC_NIST_P521 and ECC_SECG_P256K1. Default is SYMMETRIC_DEFAULT.
- `description` (String) Description of the AWS key.
- `enable_key` (Boolean) (Updateable) Enable or disable the key. Default is true.
- `enable_rotation` (Block List, Max: 1) (Updateable) Enable the key for scheduled rotation job. (see [below for nested schema](#nestedblock--enable_rotation))
- `key_policy` (Block List, Max: 1) (Updateable) Key policy to attach to the AWS key. Policy and key administrators, key_users, and AWS accounts are mutually exclusive. Specify either the policy or any one user at a time. If no parameters are specified, the default policy is used. (see [below for nested schema](#nestedblock--key_policy))
- `key_usage` (String) Specifies the intended use of the key. RSA key options: ENCRYPT_DECRYPT, SIGN_VERIFY. Default is ENCRYPT_DECRYPT. EC key options: SIGN_VERIFY. Default is SIGN_VERIFY. Symmetric key options: ENCRYPT_DECRYPT. Default is ENCRYPT_DECRYPT.
- `key_users_roles` (List of String) Key users - roles.
- `local_hosted_params` (Block List) Parameters for a AWS CloudHSM key. (see [below for nested schema](#nestedblock--local_hosted_params))
- `origin` (String) Source of the CMK's key material.  Options: AWS_KMS, EXTERNAL, EXTERNAL_KEY_STORE, AWS_CLOUDHSM. AWS_KMS will create a native AWS key and is the default for AWS native key creation. EXTERNAL will create an external AWS key and is the default for import operations. This parameter is not required for upload operations. Origin is EXTERNAL_KEY_STORE for XKS/HYOK key and AWS_CLOUDHSM for key in CloudHSM key store.
- `primary_region` (String) (Updateable) Update the primary region of a multi-region key. Can only be set for a primary key.
- `region` (String) AWS region in which to create a CloudHSM key.
- `schedule_for_deletion_days` (Number) (Updateable) Waiting period after the key is destroyed before the key is deleted. Only relevant when the resource is destroyed. Default is 7.
- `tags` (Map of String) A list of tags assigned to the CloudHSM key.

### Read-Only

- `arn` (String) The Amazon Resource Name (ARN) of the key.
- `aws_account_id` (String) AWS account ID.
- `aws_custom_key_store_id` (String) Custom keystore ID in AWS.
- `aws_key_id` (String) AWS key ID.
- `blocked` (Boolean) Parameter to indicate if AWS CloudHSM key is blocked for any data plane operation.
- `cloud_name` (String) AWS cloud.
- `created_at` (String) Date the key was created.
- `deletion_date` (String) Date the key is scheduled for deletion.
- `enabled` (Boolean) (Updateable) True if the key is enabled.
- `encryption_algorithms` (List of String) Encryption algorithms of an asymmetric key
- `expiration_model` (String) Expiration model.
- `external_accounts` (List of String) Other AWS accounts that have access to this key.
- `id` (String) CloudHSM key ID.
- `key_admins` (List of String) Key administrators - users.
- `key_admins_roles` (List of String) Key administrators - roles.
- `key_id` (String) CipherTrust Key ID.
- `key_manager` (String) Key manager.
- `key_material_origin` (String) Key material origin.
- `key_rotation_enabled` (Boolean) True if rotation is enabled in AWS for this key.
- `key_source` (String) Source of the key.
- `key_source_container_id` (String) ID of the source container of the key.
- `key_source_container_name` (String) Name of the source container of the key.
- `key_state` (String) Key state.
- `key_type` (String) Key type.
- `key_users` (List of String) Key users - users.
- `labels` (Map of String) A list of key:value pairs associated with the key.
- `linked` (Boolean) Parameter to indicate if AWS CloudHSM key is linked with AWS.
- `local_key_id` (String) CipherTrust key identifier of the external key.
- `local_key_name` (String) CipherTrust key name of the external key.
- `policy` (String) AWS key policy.
- `policy_template_tag` (Map of String) AWS key tag for an associated policy template.
- `replica_policy` (String) Replication policy.
- `rotated_at` (String) Time when this key was rotated by a scheduled rotation job.
- `rotated_from` (String) CipherTrust Manager key ID from of the key this key has been rotated from by a scheduled rotation job.
- `rotated_to` (String) CipherTrust Manager key ID which this key has been rotated too by a scheduled rotation job.
- `rotation_status` (String) Rotation status of the key.
- `synced_at` (String) Date the key was synchronized.
- `updated_at` (String) Date the key was last updated.
- `valid_to` (String) Date of key material expiry.

<a id="nestedblock--enable_rotation"></a>
### Nested Schema for `enable_rotation`

Required:

- `job_config_id` (String) (Updateable) ID of the scheduler job that will perform key rotation.
- `key_source` (String) (Updateable) Source of the key material. Options: dsm, ciphertrust.

Optional:

- `disable_encrypt` (Boolean) (Updateable) Disable encryption on the old key.
- `dsm_domain_id` (String) (Updateable) DSM domain ID, required if key_source is dsm.
- `hsm_partition_id` (String) (Updateable) HSM Luna partition ID, required if key_source is hsm-luna.


<a id="nestedblock--key_policy"></a>
### Nested Schema for `key_policy`

Optional:

- `external_accounts` (List of String) (Updateable) Other AWS accounts that can access to the key.
- `key_admins` (List of String) (Updateable) Key administrators - users.
- `key_admins_roles` (List of String) (Updateable) Key administrators - roles.
- `key_users` (List of String) (Updateable) Key users - users.
- `key_users_roles` (List of String) (Updateable) Key users - roles.
- `policy` (String) (Updateable) AWS key policy json.
- `policy_template` (String) (Updateable) CipherTrust policy template ID


<a id="nestedblock--local_hosted_params"></a>
### Nested Schema for `local_hosted_params`

Required:

- `blocked` (Boolean) Parameter to indicate if AWS CloudHSM key is blocked for any data plane operation.

Optional:

- `custom_key_store_id` (String) ID of the CloudHSM keystore where key is to be created.
- `linked` (Boolean) Parameter to indicate if AWS CloudHSM key is linked with AWS.



