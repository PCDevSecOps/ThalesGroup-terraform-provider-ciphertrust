---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_aws_key Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-
  
---

# ciphertrust_aws_key (Resource)

Primary uses of the ciphertrust_aws_key resource include:
- Creating a native AWS key
- Uploading an existing key to AWS
- Creating a new key and importing it to AWS
- Enabling key autorotation by AWS
- Scheduling key rotation that is managed by CipherTrust Manager
- Replicating multi-region keys
- Updating existing ciphertrust_aws_key resources
- Enabling/Disabling an AWS key

Key resources for upload are:
- CipherTrust Manager Key [ciphertrust_cm_key](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/cm_key)
- DSM Key [ciphertrust_dsm_key](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/dsm_key)

Container resources for import and scheduled rotation are:
- [ciphertrust_dsm_domain](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/dsm_domain)

Scheduling key rotation requires a [ciphertrust_scheduler](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/scheduler) resource.

This resource is dependent on a [ciphertrust_aws_kms](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/aws_kms) resource.


## Example Usage

```terraform
# Indirectly this resource is dependent on a ciphertrust_aws_connection resource
resource "ciphertrust_aws_connection" "aws_connection" {
  name = "connection-name"
}

# This resource is dependent on a ciphertrust_aws_kms resource
resource "ciphertrust_aws_kms" "kms" {
  account_id     = "aws-account-id"
  aws_connection = ciphertrust_aws_connection.aws_connection.id
  name           = "kms-name"
  regions        = ["aws-region"]
}

# Create a 2048 bit RSA AWS key
resource "ciphertrust_aws_key" "aws_key" {
  kms    = ciphertrust_aws_kms.kms.id
  region = "aws-region"
}

# Upload an existing CipherTrust key to AWS
resource "ciphertrust_aws_key" "aws_key" {
  kms    = ciphertrust_aws_kms.kms.id
  region = "aws-region"
  upload_key {
    source_key_identifier = ciphertrust_cm_key.cm_key.id
  }
}

# Upload an existing DSM key to AWS
resource "ciphertrust_aws_key" "aws_key" {
  kms    = ciphertrust_aws_kms.kms.id
  region = "aws-region"
  upload_key {
    source_key_identifier = ciphertrust_dsm_key.dsm_key.id
    source_key_tier       = "dsm"
  }
}

# Create a new CipherTrust key and import its key material to a new AWS key
resource "ciphertrust_aws_key" "aws_key" {
  import_key_material {
    source_key_name = "cm-key-name"
  }
  kms    = ciphertrust_aws_kms.kms.id
  region = "aws-region"
}

# Create a new DSM key and import its key material to a new AWS key
resource "ciphertrust_aws_key" "aws_key" {
  import_key_material {
    dsm_domain_id   = ciphertrust_dsm_domain.dsm_domain.id
    source_key_name = "dsm-key-name"
    source_key_tier = "dsm"
  }
  kms    = ciphertrust_aws_kms.kms.id
  region = "aws-region"
}

# Create a multi-region key
resource "ciphertrust_aws_key" "aws_multiregion_key" {
  kms          = ciphertrust_aws_kms.kms.id
  multi_region = true
  region       = "aws-region"
}

# Replicate the above key and make the replica the primary key
resource "ciphertrust_aws_key" "replicated_key" {
  region = "alternative-aws-region"
  replicate_key {
    key_id       = ciphertrust_aws_key.aws_multiregion_key.key_id
    make_primary = true
  }
}

# Create an AWS multi-region key and import its key material from a CipherTrust key
resource "ciphertrust_aws_key" "aws_external_multiregion_key" {
  import_key_material {
    source_key_name = "cm-key-name"
  }
  kms          = ciphertrust_aws_kms.kms.id
  multi_region = true
  region       = "aws-region"
}

# Replicate the above key to another region and import the same key material to the replica
resource "ciphertrust_aws_key" "replicated_key" {
  region = "alternative-aws-region"
  replicate_key {
    import_key_material = true
    key_id              = ciphertrust_aws_key.aws_external_multiregion_key.key_id
  }
}

# Schedule key rotation using a CipherTrust Manager as the key source
resource "ciphertrust_aws_key" "aws_multiregion_key" {
  enable_rotation {
    disable_encrypt = false
    job_config_id   = ciphertrust_scheduler.scheduled_rotation_job.id
    key_source      = "ciphertrust"
  }
  kms    = ciphertrust_aws_kms.kms.id
  region = "aws-region"
}

# Schedule key rotation for a key using a DSM as the key source
resource "ciphertrust_aws_key" "aws_multiregion_key" {
  enable_rotation {
    dsm_domain_id = ciphertrust_dsm_domain.dsm_domain.id
    job_config_id = ciphertrust_scheduler.scheduled_rotation_job.id
    key_source    = "dsm"
  }
  kms    = ciphertrust_aws_kms.kms.id
  region = "aws-region"
}

# Create am AWS key and enable autorotation by AWS
resource "ciphertrust_aws_key" "aws_key" {
  kms         = ciphertrust_aws_kms.kms.id
  region      = "aws-region"
  auto_rotate = true
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `region` (String) AWS region in which to create or replicate a key.

### Optional

- `alias` (Set of String) (Updateable) Alias(es) of the key. To allow for key rotation changing or removing original aliases, all aliases already assigned to another key will be ignored.
- `auto_rotate` (Boolean) (Updateable) Enable AWS autorotation on the key. Default is false.
- `bypass_policy_lockout_safety_check` (Boolean) Bypass the AWS key policy lockout safety check. Default is false.
- `customer_master_key_spec` (String) Specifies a symmetric or asymmetric key and the encryption\signing algorithms the key supports. Valid values: SYMMETRIC_DEFAULT, RSA_2048, RSA_3072, RSA_4096, ECC_NIST_P256, ECC_NIST_P384, ECC_NIST_P521 and ECC_SECG_P256K1. Default is SYMMETRIC_DEFAULT.
- `description` (String) (Updateable) Description of the AWS key.
- `enable_key` (Boolean) (Updateable) Enable or disable the key. Default is true.
- `enable_rotation` (Block List, Max: 1) (Updateable) Enable the key for scheduled rotation job. (see [below for nested schema](#nestedblock--enable_rotation))
- `import_key_material` (Block List, Max: 1) (Updateable) Key import details. (see [below for nested schema](#nestedblock--import_key_material))
- `key_policy` (Block List, Max: 1) (Updateable) Key policy to attach to the AWS key. Policy and key administrators, key_users, and AWS accounts are mutually exclusive. Specify either the policy or any one user at a time. If no parameters are specified, the default policy is used. (see [below for nested schema](#nestedblock--key_policy))
- `key_usage` (String) Specifies the intended use of the key. RSA key options: ENCRYPT_DECRYPT, SIGN_VERIFY. Default is ENCRYPT_DECRYPT. EC key options: SIGN_VERIFY. Default is SIGN_VERIFY. Symmetric key options: ENCRYPT_DECRYPT. Default is ENCRYPT_DECRYPT.
- `kms` (String) Name or ID of the kms. Required unless replicating a multi-user key.
- `multi_region` (Boolean) Creates or identifies a multi-region key.
- `origin` (String) Source of the CMK's key material.  Options: AWS_KMS, EXTERNAL. AWS_KMS will create a native AWS key and is the default for AWS native key creation. EXTERNAL will create an external AWS key and is the default for import operations. This parameter is not required for upload operations.
- `primary_region` (String) (Updateable) Update the primary region of a multi-region key. Can only be set for a primary key.
- `replicate_key` (Block List, Max: 1) Key replication details. (see [below for nested schema](#nestedblock--replicate_key))
- `schedule_for_deletion_days` (Number) (Updateable) Waiting period after the key is destroyed before the key is deleted. Only relevant when the resource is destroyed. Default is 7.
- `tags` (Map of String) A list of key:value pairs to assign to the key.
- `upload_key` (Block List, Max: 1) Key upload details. (see [below for nested schema](#nestedblock--upload_key))

### Read-Only

- `arn` (String) The Amazon Resource Name (ARN) of the key.
- `aws_account_id` (String) AWS account ID.
- `aws_key_id` (String) AWS key ID.
- `cloud_name` (String) AWS cloud.
- `created_at` (String) Date the key was created.
- `deletion_date` (String) Date the key is scheduled for deletion.
- `enabled` (Boolean) (Updateable) True if the key is enabled.
- `encryption_algorithms` (List of String) Encryption algorithms of an asymmetric key
- `expiration_model` (String) Expiration model.
- `external_accounts` (List of String) Other AWS accounts that have access to this key.
- `id` (String) AWS region and AWS key identifier separated by a backslash.
- `key_admins` (List of String) Key administrators - users.
- `key_admins_roles` (List of String) Key administrators - roles.
- `key_id` (String) CipherTrust Key ID.
- `key_manager` (String) Key manager.
- `key_material_origin` (String) Key material origin.
- `key_rotation_enabled` (Boolean) True if rotation is enabled in AWS for this key.
- `key_source` (String) Source of the key.
- `key_state` (String) Key state.
- `key_type` (String) Key type.
- `key_users` (List of String) Key users - users.
- `key_users_roles` (List of String) Key users - roles.
- `labels` (Map of String) A list of key:value pairs associated with the key.
- `local_key_id` (String) CipherTrust key identifier of the external key.
- `local_key_name` (String) CipherTrust key name of the external key.
- `multi_region_key_type` (String) Indicates if the key is the primary key or a replica key.
- `multi_region_primary_key` (Map of String) Multi-region primary key details.
- `multi_region_replica_keys` (List of Map of String) Multi-region primary key details.
- `policy` (String) AWS key policy.
- `policy_template_tag` (Map of String) AWS key tag for an associated policy template.
- `replica_policy` (String) Replication policy.
- `rotated_at` (String) Time when this key was rotated by a scheduled rotation job.
- `rotated_from` (String) CipherTrust Manager key ID from of the key this key has been rotated from by a scheduled rotation job.
- `rotated_to` (String) CipherTrust Manager key ID which this key has been rotated too by a scheduled rotation job.
- `rotation_status` (String) Rotation status of the key.
- `synced_at` (String) Date the key was synchronized.
- `updated_at` (String) Date the key was last updated.
- `valid_to` (String) Date of key material expiry.

<a id="nestedblock--enable_rotation"></a>
### Nested Schema for `enable_rotation`

Required:

- `job_config_id` (String) (Updateable) ID of the scheduler job that will perform key rotation.
- `key_source` (String) (Updateable) Source of the key material. Options: dsm, ciphertrust.

Optional:

- `disable_encrypt` (Boolean) (Updateable) Disable encryption on the old key.
- `dsm_domain_id` (String) (Updateable) DSM domain ID, required if key_source is dsm.
- `hsm_partition_id` (String) (Updateable) HSM Luna partition ID, required if key_source is hsm-luna.


<a id="nestedblock--import_key_material"></a>
### Nested Schema for `import_key_material`

Required:

- `source_key_name` (String) Name of the key created for key material.

Optional:

- `dsm_domain_id` (String) (Updateable) Domain for the DSM key. Required if source_key_tier is dsm.
- `hsm_partition_id` (String) (Updateable) Partition for the HSM Luna key. Required if source_key_tier is hsm-luna.
- `key_expiration` (Boolean) (Updateable) Enable key material expiration.
- `source_key_tier` (String) Source of the key. Options: local, dsm, hsm-luna. Default is local.
- `valid_to` (String) (Updateable) Date of key material expiry in UTC time in RFC3339 format. For example, 2022-07-03T14:24:00Z.


<a id="nestedblock--key_policy"></a>
### Nested Schema for `key_policy`

Optional:

- `external_accounts` (List of String) (Updateable) Other AWS accounts that can access to the key.
- `key_admins` (List of String) (Updateable) Key administrators - users.
- `key_admins_roles` (List of String) (Updateable) Key administrators - roles.
- `key_users` (List of String) (Updateable) Key users - users.
- `key_users_roles` (List of String) (Updateable) Key users - roles.
- `policy` (String) (Updateable) AWS key policy json.
- `policy_template` (String) (Updateable) CipherTrust policy template ID


<a id="nestedblock--replicate_key"></a>
### Nested Schema for `replicate_key`

Required:

- `key_id` (String) CipherTrust key ID of they key to replicate.

Optional:

- `import_key_material` (Boolean) Import key material to a replicated external key.
- `key_expiration` (Boolean) Enable key expiration of the replicated key. Only applies to external keys.
- `make_primary` (Boolean) Update the primary key region to the replicated key's region following replication.
- `valid_to` (String) Date the key material of the replicated key expires. Only applies to external keys. Set as UTC time in RFC3339 format. For example, 2022-07-03T14:24:00Z.


<a id="nestedblock--upload_key"></a>
### Nested Schema for `upload_key`

Required:

- `source_key_identifier` (String) DSM or CipherTrust key ID to upload to AWS.

Optional:

- `key_expiration` (Boolean) Enable key expiration.
- `source_key_tier` (String) Source of the key. Options: local, dsm and hsm-luna. Default is local.
- `valid_to` (String) Date of key expiry in UTC time in RFC3339 format. For example, 2022-07-03T14:24:00Z.


